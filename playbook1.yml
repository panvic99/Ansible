---
- name: Deploying simple web app
  hosts: ec2-instance-1
  vars:
    mysql_root_password: password 
  tasks:
    - name: Update apt cache
      apt:
        update_cache: yes
      become: yes

    - name: Python and its dependencies
      apt: name={{ item }} state=present
      with_items:
        - python3
        - python3-setuptools
        - python3-dev
        - build-essential
        - python3-pip
        - python3-mysqldb
      become: yes

    - name: Install MySQL database
      apt: name={{ item }} state=present
      with_items:
        - mysql-server
        - mysql-client
      become: yes

    - name: Start the database service
      service: 
        name: mysql
        state: started
        enabled: true

    - name: Set MySQL root password
      mysql_user:
        name: root
        host: localhost
        password: root@123
        login_unix_socket: /var/run/mysqld/mysqld.sock
        state: present
      become: yes


    - name: Create a new database with name 'employee_db'
      mysql_db:
        name: employee_db
        state: present
    
